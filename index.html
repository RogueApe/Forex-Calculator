<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- iOS support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Pips Calculator (by VP)">

  <!-- Prevent Zoom on Input Tap (iOS)  -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <!-- link to .CSS file -->
  <link rel="stylesheet" href="styles.css">

  <link rel="apple-touch-icon" href="icon.png">

  <link href="https://fonts.googleapis.com/css2?family=Comfortaa&display=swap" rel="stylesheet">

  <!-- for title font -->
  <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">


  <title>Forex Pips Calculator</title>
  <link rel="icon" href="icon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Comfortaa&family=Poppins:wght@600&display=swap"
    rel="stylesheet" />
</head>

<body>

  <div class="slideshow-bg">
    <img src="bg1.jpg" alt="BG1" />
    <img src="bg2.jpg" alt="BG2" />
    <img src="bg3.jpg" alt="BG3" />
  </div>

  <div class="container">
    <h2 style="font-family: 'Oswald', sans-serif; font-size: 28px; line-height: 1.75; margin-bottom: 5px;">
      Forex Pips Calculator
      <div style="font-size: 4px; font-weight: normal; font-family: 'Av08MGS', sans-serif; line-height: 1.2;">
        (developed by VP)
      </div>
    </h2>



    <label>Currency Pair:</label>
    <select id="pair">
      <option value="xauusd">XAU/USD</option>
      <option value="eurusd">EUR/USD</option>
      <option value="gbpusd">GBP/USD</option>
      <option value="gbpjpy">GBP/JPY</option>
    </select>

    <label>Account Capital (USD):</label>
    <input type="number" id="capital" />

    <label>Conversion Rate (1 USD to MYR):</label>
    <input type="number" id="conversion" />

    <label>Lot Size:</label>
    <input type="number" id="lot" step="0.01" />

    <label>Entry Price:</label>
    <input type="number" id="entry" />

    <!-- Temporarily delete this as I don't need this input -->
    <!-- <label>Exit Price:</label>
    <input type="number" id="exit" /> -->

    <label>TP Price:</label>
    <input type="number" id="tp" />

    <label>SL Price:</label>
    <input type="number" id="sl" />

    <button onclick="calculate()">Calculate</button>

    <!-- "Action": "Add new input field for Target Profit (USD)" -->
    <!-- Newly added in version 0.2.2 -->
    <label>Target Profit (USD):</label>
    <input type="number" id="targetProfit" />

    <div class="result" id="resultBox" style="display:none;">
      <h3>Result</h3>
      <p>Pips: <span id="pips"></span></p>
      <p>RR Ratio: <span id="rr"></span></p>
      <p>Profit (USD): <span id="profitusd" class="highlight-green"></span></p>
      <p>Profit (MYR): <span id="profitmyr" class="highlight-green"></span></p>
      <p>Price Loss (USD): <span id="lossusd" class="highlight-red"></span></p>
      <p>Price Loss (MYR): <span id="lossmyr" class="highlight-red"></span></p>
      <p>Risk (by %): <span id="riskpercent"></span></p>
    </div>
  </div>

  <audio id="audioGood" src="good.mp3" preload="auto"></audio>
  <audio id="audioCaution" src="caution.mp3" preload="auto"></audio>
  <audio id="audioDanger" src="danger.mp3" preload="auto"></audio>

  <script>
    function calculate() {
      const pair = document.getElementById('pair').value;
      const capital = parseFloat(document.getElementById('capital').value);
      const conversion = parseFloat(document.getElementById('conversion').value);
      const lotInput = document.getElementById('lot');
      let lot = parseFloat(lotInput.value);
      const entry = parseFloat(document.getElementById('entry').value);
      const tp = parseFloat(document.getElementById('tp').value);
      const sl = parseFloat(document.getElementById('sl').value);
      const targetProfit = parseFloat(document.getElementById('targetProfit').value);

      let autoPips = 0;
      let profitPerLot = 0;
      let generatedLot = null;

      if (!isNaN(entry) && !isNaN(tp)) {
        switch (pair) {
          case "xauusd":
            autoPips = Math.abs(entry - tp) * 10;
            profitPerLot = autoPips * 10;
            break;
          case "eurusd":
          case "gbpusd":
            autoPips = Math.abs(entry - tp) * 10000;
            profitPerLot = autoPips * 10;
            break;
          case "gbpjpy":
            autoPips = Math.abs(entry - tp) * 1000;
            profitPerLot = autoPips * 0.695;
            break;
        }

        // If lot is either empty or was generated earlier, and target profit is given
        if (!isNaN(targetProfit) && profitPerLot) {


          generatedLot = targetProfit / profitPerLot;
          const finalLot = Math.max(0.01, parseFloat(generatedLot.toFixed(2)));
          lotInput.value = finalLot;
          lot = finalLot;



          lotInput.classList.add('generated-lot');

          // Reset + re-trigger animation
          lotInput.classList.remove('lotShake');
          void lotInput.offsetWidth;
          lotInput.classList.add('lotShake');

          lot = parseFloat(generatedLot.toFixed(2));
        } else {
          lotInput.classList.remove('generated-lot');
          lotInput.classList.remove('lotShake');
        }

      }

      let pips = 0;
      let profit = 0;
      let loss = 0;

      const calcPips = (a, b) => Math.abs(a - b);
      const calcRR = () => (!isNaN(tp) && !isNaN(sl)) ? (Math.abs(entry - tp) / Math.abs(entry - sl)).toFixed(1) : '-';

      if (!isNaN(entry)) {
        let priceDiff = 0;
        if (!isNaN(tp)) priceDiff = calcPips(entry, tp);

        switch (pair) {
          case "xauusd":
            pips = priceDiff * 10;
            profit = !isNaN(tp) ? pips * 10 * lot : 0;
            loss = !isNaN(sl) ? calcPips(entry, sl) * 10 * 10 * lot : 0;
            break;
          case "eurusd":
          case "gbpusd":
            pips = priceDiff * 10000;
            profit = !isNaN(tp) ? pips * 10 * lot : 0;
            loss = !isNaN(sl) ? calcPips(entry, sl) * 10000 * 10 * lot : 0;
            break;
          case "gbpjpy":
            pips = priceDiff * 1000;
            profit = !isNaN(tp) ? pips * 0.695 * lot : 0;
            loss = !isNaN(sl) ? calcPips(entry, sl) * 1000 * 0.695 * lot : 0;
            break;
        }
      }

      const rr = calcRR();
      const riskPercent = (loss > 0 && capital > 0) ? ((loss / capital) * 100).toFixed(2) : '-';
      const profitMYR = conversion && profit ? (profit * conversion).toFixed(2) : '-';
      const lossMYR = conversion && loss ? (loss * conversion).toFixed(2) : '-';

      document.getElementById('pips').textContent = Math.round(pips);
      document.getElementById('rr').textContent = rr;
      document.getElementById('profitusd').textContent = profit.toFixed(1);
      document.getElementById('profitmyr').textContent = (conversion && profit ? (profit * conversion).toFixed(1) : '-');
      document.getElementById('lossusd').textContent = loss.toFixed(1);
      document.getElementById('lossmyr').textContent = (conversion && loss ? (loss * conversion).toFixed(1) : '-');
      document.getElementById('riskpercent').textContent = riskPercent + '%';

      const riskClass = riskPercent === '-' ? '' :
        riskPercent <= 10 ? 'risk-blue' :
          riskPercent <= 25 ? 'risk-orange' : 'risk-danger';

      const audioGood = document.getElementById("audioGood");
      const audioCaution = document.getElementById("audioCaution");
      const audioDanger = document.getElementById("audioDanger");
      // update 
      const pipsSpan = document.getElementById('pips');
      const rrSpan = document.getElementById('rr');
      const profitUsdSpan = document.getElementById('profitusd');
      const profitMyrSpan = document.getElementById('profitmyr');
      const lossUsdSpan = document.getElementById('lossusd');
      const lossMyrSpan = document.getElementById('lossmyr');
      const riskPercentSpan = document.getElementById('riskpercent');

      // First, clear all classes and reset animation
      [pipsSpan, rrSpan, profitUsdSpan, profitMyrSpan, lossUsdSpan, lossMyrSpan, riskPercentSpan].forEach(span => {
        span.classList.remove('risk-blue', 'risk-orange', 'risk-danger');
        void span.offsetWidth;
      });

      // Always apply light blue for pips, RR, profit
      [pipsSpan, rrSpan, profitUsdSpan, profitMyrSpan].forEach(span => {
        span.classList.add('risk-blue');
      });

      // Always apply red for loss (in case it's removed elsewhere accidentally)
      lossUsdSpan.classList.add('highlight-red');
      lossMyrSpan.classList.add('highlight-red');

      // Only risk percent uses risk logic
      const numericRisk = parseFloat(riskPercent);
      if (!isNaN(numericRisk)) {
        if (numericRisk <= 10) {
          riskPercentSpan.classList.add('risk-blue');
          audioGood.play();
        } else if (numericRisk <= 25) {
          riskPercentSpan.classList.add('risk-orange');
          audioCaution.play();
        } else {
          riskPercentSpan.classList.add('risk-danger');
          audioDanger.play();
        }
      }


      document.getElementById('resultBox').style.display = 'block';
    }

    // for background slideshow
    const images = ['images/bg1.jpg', 'images/bg2.jpg', 'images/bg3.jpg'];
    let currentImage = 0;

    function changeBackground() {
      document.body.style.backgroundImage = `url('${images[currentImage]}')`;
      currentImage = (currentImage + 1) % images.length;
    }

    setInterval(changeBackground, 8000); // Change image every 8 seconds
    changeBackground(); // Run once on load
  </script>
</body>

</html>
